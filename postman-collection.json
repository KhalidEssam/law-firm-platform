{
    "info": {
        "name": "Legal Platform API",
        "description": "Complete API collection for the Legal Platform with account management, profiles, plans, payments, consultations, requests, memberships, billing, notifications, and call requests",
        "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
        "version": "2.0.0"
    },
    "auth": {
        "type": "bearer",
        "bearer": [
            {
                "key": "token",
                "value": "{{auth_token}}",
                "type": "string"
            }
        ]
    },
    "variable": [
        {
            "key": "base_url",
            "value": "http://localhost:3000",
            "type": "string"
        },
        {
            "key": "auth_token",
            "value": "",
            "type": "string"
        },
        {
            "key": "USER_ID",
            "value": "",
            "type": "string"
        },
        {
            "key": "TIER_ID",
            "value": "",
            "type": "string"
        },
        {
            "key": "MEMBERSHIP_ID",
            "value": "",
            "type": "string"
        },
        {
            "key": "INVOICE_ID",
            "value": "",
            "type": "string"
        },
        {
            "key": "PAYMENT_ID",
            "value": "",
            "type": "string"
        },
        {
            "key": "CALL_REQUEST_ID",
            "value": "",
            "type": "string"
        },
        {
            "key": "PROVIDER_ID",
            "value": "",
            "type": "string"
        },
        {
            "key": "SUBSCRIBER_A_ID",
            "value": "",
            "type": "string"
        },
        {
            "key": "SUBSCRIBER_B_ID",
            "value": "",
            "type": "string"
        },
        {
            "key": "PROVIDER_1_USER_ID",
            "value": "",
            "type": "string"
        },
        {
            "key": "PROVIDER_2_USER_ID",
            "value": "",
            "type": "string"
        },
        {
            "key": "PROVIDER_1_PROFILE_ID",
            "value": "",
            "type": "string"
        },
        {
            "key": "PROVIDER_2_PROFILE_ID",
            "value": "",
            "type": "string"
        },
        {
            "key": "ROUTING_RULE_RR_ID",
            "value": "",
            "type": "string"
        },
        {
            "key": "ROUTING_RULE_LB_ID",
            "value": "",
            "type": "string"
        },
        {
            "key": "CONSULTATION_1_ID",
            "value": "",
            "type": "string"
        },
        {
            "key": "CONSULTATION_2_ID",
            "value": "",
            "type": "string"
        },
        {
            "key": "CONSULTATION_3_ID",
            "value": "",
            "type": "string"
        },
        {
            "key": "LEGAL_OPINION_1_ID",
            "value": "",
            "type": "string"
        }
    ],
    "item": [
        {
            "name": "Test Scenarios",
            "description": "Sequential test scenarios for complete flows",
            "item": [
                {
                    "name": "Scenario 1: Membership & Quota Flow",
                    "description": "Complete membership lifecycle with quota consumption",
                    "item": [
                        {
                            "name": "1. Create User",
                            "event": [
                                {
                                    "listen": "test",
                                    "script": {
                                        "exec": [
                                            "var jsonData = pm.response.json();",
                                            "if (jsonData.user && jsonData.user.id) {",
                                            "    pm.environment.set('USER_ID', jsonData.user.id);",
                                            "    pm.test('User created successfully', function() {",
                                            "        pm.expect(jsonData.user.id).to.be.a('string');",
                                            "    });",
                                            "}"
                                        ],
                                        "type": "text/javascript"
                                    }
                                }
                            ],
                            "request": {
                                "method": "POST",
                                "header": [
                                    {
                                        "key": "Content-Type",
                                        "value": "application/json"
                                    }
                                ],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"email\": \"testuser@example.com\",\n    \"username\": \"testuser\",\n    \"fullName\": \"Test User\"\n}"
                                },
                                "url": {
                                    "raw": "{{base_url}}/users",
                                    "host": ["{{base_url}}"],
                                    "path": ["users"]
                                }
                            }
                        },
                        {
                            "name": "2. Create Membership Tier",
                            "event": [
                                {
                                    "listen": "test",
                                    "script": {
                                        "exec": [
                                            "var jsonData = pm.response.json();",
                                            "if (jsonData.tier && jsonData.tier.id) {",
                                            "    pm.environment.set('TIER_ID', jsonData.tier.id);",
                                            "    pm.test('Tier created with quota', function() {",
                                            "        pm.expect(jsonData.tier.quota).to.be.an('object');",
                                            "    });",
                                            "}"
                                        ],
                                        "type": "text/javascript"
                                    }
                                }
                            ],
                            "request": {
                                "method": "POST",
                                "header": [
                                    {
                                        "key": "Content-Type",
                                        "value": "application/json"
                                    }
                                ],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"name\": \"Premium Plan\",\n    \"nameAr\": \"الخطة المميزة\",\n    \"description\": \"Premium membership with full access to legal services\",\n    \"descriptionAr\": \"عضوية مميزة مع وصول كامل للخدمات القانونية\",\n    \"price\": 500,\n    \"currency\": \"SAR\",\n    \"billingCycle\": \"monthly\",\n    \"quota\": {\n        \"consultationsPerMonth\": 10,\n        \"opinionsPerMonth\": 5,\n        \"casesPerMonth\": 2,\n        \"callMinutesPerMonth\": 60\n    },\n    \"benefits\": [\n        \"Priority support\",\n        \"Document storage\",\n        \"Video consultations\"\n    ],\n    \"isActive\": true\n}"
                                },
                                "url": {
                                    "raw": "{{base_url}}/memberships/tiers",
                                    "host": ["{{base_url}}"],
                                    "path": ["memberships", "tiers"]
                                }
                            }
                        },
                        {
                            "name": "3. Create Membership",
                            "event": [
                                {
                                    "listen": "test",
                                    "script": {
                                        "exec": [
                                            "var jsonData = pm.response.json();",
                                            "if (jsonData.membership && jsonData.membership.id) {",
                                            "    pm.environment.set('MEMBERSHIP_ID', jsonData.membership.id);",
                                            "    pm.test('Membership created', function() {",
                                            "        pm.expect(jsonData.membership.isActive).to.equal(true);",
                                            "    });",
                                            "}"
                                        ],
                                        "type": "text/javascript"
                                    }
                                }
                            ],
                            "request": {
                                "method": "POST",
                                "header": [
                                    {
                                        "key": "Content-Type",
                                        "value": "application/json"
                                    }
                                ],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"userId\": \"{{USER_ID}}\",\n    \"tierId\": {{TIER_ID}},\n    \"durationInMonths\": 12,\n    \"autoRenew\": true\n}"
                                },
                                "url": {
                                    "raw": "{{base_url}}/memberships",
                                    "host": ["{{base_url}}"],
                                    "path": ["memberships"]
                                }
                            }
                        },
                        {
                            "name": "4. Create Invoice",
                            "event": [
                                {
                                    "listen": "test",
                                    "script": {
                                        "exec": [
                                            "var jsonData = pm.response.json();",
                                            "if (jsonData.invoice && jsonData.invoice.id) {",
                                            "    pm.environment.set('INVOICE_ID', jsonData.invoice.id);",
                                            "    pm.test('Invoice created with pending status', function() {",
                                            "        pm.expect(jsonData.invoice.status).to.equal('pending');",
                                            "    });",
                                            "}"
                                        ],
                                        "type": "text/javascript"
                                    }
                                }
                            ],
                            "request": {
                                "method": "POST",
                                "header": [
                                    {
                                        "key": "Content-Type",
                                        "value": "application/json"
                                    }
                                ],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"membershipId\": \"{{MEMBERSHIP_ID}}\",\n    \"amount\": 500,\n    \"currency\": \"SAR\",\n    \"dueDate\": \"2025-12-31\",\n    \"description\": \"Monthly subscription - Premium Plan\"\n}"
                                },
                                "url": {
                                    "raw": "{{base_url}}/billing/invoices",
                                    "host": ["{{base_url}}"],
                                    "path": ["billing", "invoices"]
                                }
                            }
                        },
                        {
                            "name": "5. Process Payment",
                            "event": [
                                {
                                    "listen": "test",
                                    "script": {
                                        "exec": [
                                            "var jsonData = pm.response.json();",
                                            "if (jsonData.payment && jsonData.payment.id) {",
                                            "    pm.environment.set('PAYMENT_ID', jsonData.payment.id);",
                                            "    pm.test('Payment initiated', function() {",
                                            "        pm.expect(jsonData.payment.status).to.equal('pending');",
                                            "    });",
                                            "}"
                                        ],
                                        "type": "text/javascript"
                                    }
                                }
                            ],
                            "request": {
                                "method": "POST",
                                "header": [
                                    {
                                        "key": "Content-Type",
                                        "value": "application/json"
                                    }
                                ],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"invoiceId\": \"{{INVOICE_ID}}\",\n    \"provider\": \"stripe\",\n    \"amount\": 500,\n    \"currency\": \"SAR\"\n}"
                                },
                                "url": {
                                    "raw": "{{base_url}}/memberships/{{MEMBERSHIP_ID}}/payments",
                                    "host": ["{{base_url}}"],
                                    "path": ["memberships", "{{MEMBERSHIP_ID}}", "payments"]
                                }
                            }
                        },
                        {
                            "name": "6. Complete Payment",
                            "request": {
                                "method": "POST",
                                "header": [
                                    {
                                        "key": "Content-Type",
                                        "value": "application/json"
                                    }
                                ],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"providerTxnId\": \"txn_stripe_123456\"\n}"
                                },
                                "url": {
                                    "raw": "{{base_url}}/memberships/payments/{{PAYMENT_ID}}/complete",
                                    "host": ["{{base_url}}"],
                                    "path": ["memberships", "payments", "{{PAYMENT_ID}}", "complete"]
                                }
                            }
                        },
                        {
                            "name": "7. Check Quota (Before)",
                            "event": [
                                {
                                    "listen": "test",
                                    "script": {
                                        "exec": [
                                            "var jsonData = pm.response.json();",
                                            "pm.test('Quota has correct initial values', function() {",
                                            "    pm.expect(jsonData.quota.used).to.equal(0);",
                                            "    pm.expect(jsonData.quota.limit).to.equal(10);",
                                            "    pm.expect(jsonData.quota.remaining).to.equal(10);",
                                            "});"
                                        ],
                                        "type": "text/javascript"
                                    }
                                }
                            ],
                            "request": {
                                "method": "GET",
                                "header": [],
                                "url": {
                                    "raw": "{{base_url}}/memberships/{{MEMBERSHIP_ID}}/quota/consultations",
                                    "host": ["{{base_url}}"],
                                    "path": ["memberships", "{{MEMBERSHIP_ID}}", "quota", "consultations"]
                                }
                            }
                        },
                        {
                            "name": "8. Consume Quota",
                            "event": [
                                {
                                    "listen": "test",
                                    "script": {
                                        "exec": [
                                            "pm.test('Quota consumed successfully', function() {",
                                            "    pm.expect(pm.response.code).to.equal(200);",
                                            "});"
                                        ],
                                        "type": "text/javascript"
                                    }
                                }
                            ],
                            "request": {
                                "method": "PUT",
                                "header": [
                                    {
                                        "key": "Content-Type",
                                        "value": "application/json"
                                    }
                                ],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"amount\": 1\n}"
                                },
                                "url": {
                                    "raw": "{{base_url}}/memberships/{{MEMBERSHIP_ID}}/quota/consultations/consume",
                                    "host": ["{{base_url}}"],
                                    "path": ["memberships", "{{MEMBERSHIP_ID}}", "quota", "consultations", "consume"]
                                }
                            }
                        },
                        {
                            "name": "9. Check Quota (After)",
                            "event": [
                                {
                                    "listen": "test",
                                    "script": {
                                        "exec": [
                                            "var jsonData = pm.response.json();",
                                            "pm.test('Quota updated after consumption', function() {",
                                            "    pm.expect(jsonData.quota.used).to.equal(1);",
                                            "    pm.expect(jsonData.quota.remaining).to.equal(9);",
                                            "});"
                                        ],
                                        "type": "text/javascript"
                                    }
                                }
                            ],
                            "request": {
                                "method": "GET",
                                "header": [],
                                "url": {
                                    "raw": "{{base_url}}/memberships/{{MEMBERSHIP_ID}}/quota/consultations",
                                    "host": ["{{base_url}}"],
                                    "path": ["memberships", "{{MEMBERSHIP_ID}}", "quota", "consultations"]
                                }
                            }
                        },
                        {
                            "name": "10. Check Notifications",
                            "request": {
                                "method": "GET",
                                "header": [],
                                "url": {
                                    "raw": "{{base_url}}/notifications/user/{{USER_ID}}",
                                    "host": ["{{base_url}}"],
                                    "path": ["notifications", "user", "{{USER_ID}}"]
                                }
                            }
                        }
                    ]
                },
                {
                    "name": "Scenario 2: Call Request Flow",
                    "description": "Complete call request lifecycle from creation to completion",
                    "item": [
                        {
                            "name": "1. Create Call Request",
                            "event": [
                                {
                                    "listen": "test",
                                    "script": {
                                        "exec": [
                                            "var jsonData = pm.response.json();",
                                            "if (jsonData.callRequest && jsonData.callRequest.id) {",
                                            "    pm.environment.set('CALL_REQUEST_ID', jsonData.callRequest.id);",
                                            "    pm.test('Call request created with pending status', function() {",
                                            "        pm.expect(jsonData.callRequest.status).to.equal('pending');",
                                            "    });",
                                            "}"
                                        ],
                                        "type": "text/javascript"
                                    }
                                }
                            ],
                            "request": {
                                "method": "POST",
                                "header": [
                                    {
                                        "key": "Content-Type",
                                        "value": "application/json"
                                    }
                                ],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"subscriberId\": \"{{USER_ID}}\",\n    \"purpose\": \"Legal consultation regarding property dispute\",\n    \"consultationType\": \"legal_advice\",\n    \"preferredDate\": \"2025-12-20\",\n    \"preferredTime\": \"14:00\"\n}"
                                },
                                "url": {
                                    "raw": "{{base_url}}/call-requests",
                                    "host": ["{{base_url}}"],
                                    "path": ["call-requests"]
                                }
                            }
                        },
                        {
                            "name": "2. Assign Provider",
                            "event": [
                                {
                                    "listen": "test",
                                    "script": {
                                        "exec": [
                                            "var jsonData = pm.response.json();",
                                            "pm.test('Provider assigned', function() {",
                                            "    pm.expect(jsonData.callRequest.status).to.equal('assigned');",
                                            "});"
                                        ],
                                        "type": "text/javascript"
                                    }
                                }
                            ],
                            "request": {
                                "method": "POST",
                                "header": [
                                    {
                                        "key": "Content-Type",
                                        "value": "application/json"
                                    }
                                ],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"providerId\": \"{{PROVIDER_ID}}\"\n}"
                                },
                                "url": {
                                    "raw": "{{base_url}}/call-requests/{{CALL_REQUEST_ID}}/assign",
                                    "host": ["{{base_url}}"],
                                    "path": ["call-requests", "{{CALL_REQUEST_ID}}", "assign"]
                                }
                            }
                        },
                        {
                            "name": "3. Schedule Call",
                            "event": [
                                {
                                    "listen": "test",
                                    "script": {
                                        "exec": [
                                            "var jsonData = pm.response.json();",
                                            "pm.test('Call scheduled', function() {",
                                            "    pm.expect(jsonData.callRequest.status).to.equal('scheduled');",
                                            "    pm.expect(jsonData.callRequest.callLink).to.be.a('string');",
                                            "});"
                                        ],
                                        "type": "text/javascript"
                                    }
                                }
                            ],
                            "request": {
                                "method": "POST",
                                "header": [
                                    {
                                        "key": "Content-Type",
                                        "value": "application/json"
                                    }
                                ],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"scheduledAt\": \"2025-12-20T14:00:00Z\",\n    \"durationMinutes\": 30,\n    \"platform\": \"zoom\",\n    \"callLink\": \"https://zoom.us/j/123456789\"\n}"
                                },
                                "url": {
                                    "raw": "{{base_url}}/call-requests/{{CALL_REQUEST_ID}}/schedule",
                                    "host": ["{{base_url}}"],
                                    "path": ["call-requests", "{{CALL_REQUEST_ID}}", "schedule"]
                                }
                            }
                        },
                        {
                            "name": "4. Start Call",
                            "event": [
                                {
                                    "listen": "test",
                                    "script": {
                                        "exec": [
                                            "var jsonData = pm.response.json();",
                                            "pm.test('Call started', function() {",
                                            "    pm.expect(jsonData.callRequest.status).to.equal('in_progress');",
                                            "    pm.expect(jsonData.callRequest.callStartedAt).to.be.a('string');",
                                            "});"
                                        ],
                                        "type": "text/javascript"
                                    }
                                }
                            ],
                            "request": {
                                "method": "POST",
                                "header": [],
                                "url": {
                                    "raw": "{{base_url}}/call-requests/{{CALL_REQUEST_ID}}/start",
                                    "host": ["{{base_url}}"],
                                    "path": ["call-requests", "{{CALL_REQUEST_ID}}", "start"]
                                }
                            }
                        },
                        {
                            "name": "5. End Call",
                            "event": [
                                {
                                    "listen": "test",
                                    "script": {
                                        "exec": [
                                            "var jsonData = pm.response.json();",
                                            "pm.test('Call completed', function() {",
                                            "    pm.expect(jsonData.callRequest.status).to.equal('completed');",
                                            "    pm.expect(jsonData.callRequest.actualDuration).to.be.a('number');",
                                            "});"
                                        ],
                                        "type": "text/javascript"
                                    }
                                }
                            ],
                            "request": {
                                "method": "POST",
                                "header": [
                                    {
                                        "key": "Content-Type",
                                        "value": "application/json"
                                    }
                                ],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"recordingUrl\": \"https://storage.example.com/recordings/call-123.mp4\"\n}"
                                },
                                "url": {
                                    "raw": "{{base_url}}/call-requests/{{CALL_REQUEST_ID}}/end",
                                    "host": ["{{base_url}}"],
                                    "path": ["call-requests", "{{CALL_REQUEST_ID}}", "end"]
                                }
                            }
                        },
                        {
                            "name": "6. Check Call Minutes",
                            "request": {
                                "method": "GET",
                                "header": [],
                                "url": {
                                    "raw": "{{base_url}}/memberships/{{MEMBERSHIP_ID}}/quota/callMinutes",
                                    "host": ["{{base_url}}"],
                                    "path": ["memberships", "{{MEMBERSHIP_ID}}", "quota", "callMinutes"]
                                }
                            }
                        }
                    ]
                },
                {
                    "name": "Scenario 3: Membership Upgrade Flow",
                    "description": "Upgrade membership tier and verify quota changes",
                    "item": [
                        {
                            "name": "1. Get Current Membership",
                            "request": {
                                "method": "GET",
                                "header": [],
                                "url": {
                                    "raw": "{{base_url}}/memberships/user/{{USER_ID}}",
                                    "host": ["{{base_url}}"],
                                    "path": ["memberships", "user", "{{USER_ID}}"]
                                }
                            }
                        },
                        {
                            "name": "2. View Available Tiers",
                            "request": {
                                "method": "GET",
                                "header": [],
                                "url": {
                                    "raw": "{{base_url}}/memberships/tiers",
                                    "host": ["{{base_url}}"],
                                    "path": ["memberships", "tiers"]
                                }
                            }
                        },
                        {
                            "name": "3. Upgrade Membership",
                            "event": [
                                {
                                    "listen": "test",
                                    "script": {
                                        "exec": [
                                            "var jsonData = pm.response.json();",
                                            "pm.test('Membership upgraded', function() {",
                                            "    pm.expect(jsonData.result.changeLog.changeType).to.equal('upgrade');",
                                            "});"
                                        ],
                                        "type": "text/javascript"
                                    }
                                }
                            ],
                            "request": {
                                "method": "POST",
                                "header": [
                                    {
                                        "key": "Content-Type",
                                        "value": "application/json"
                                    }
                                ],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"newTierId\": 2\n}"
                                },
                                "url": {
                                    "raw": "{{base_url}}/memberships/{{MEMBERSHIP_ID}}/upgrade",
                                    "host": ["{{base_url}}"],
                                    "path": ["memberships", "{{MEMBERSHIP_ID}}", "upgrade"]
                                }
                            }
                        },
                        {
                            "name": "4. Verify New Quota",
                            "request": {
                                "method": "GET",
                                "header": [],
                                "url": {
                                    "raw": "{{base_url}}/memberships/{{MEMBERSHIP_ID}}/quota/consultations",
                                    "host": ["{{base_url}}"],
                                    "path": ["memberships", "{{MEMBERSHIP_ID}}", "quota", "consultations"]
                                }
                            }
                        }
                    ]
                },
                {
                    "name": "Scenario 4: Routing & Auto-Assignment Flow",
                    "description": "Complete routing test with 2 subscribers, 2 providers, routing rules, and auto-assignment behavior verification",
                    "item": [
                        {
                            "name": "=== PHASE 1: SETUP USERS ===",
                            "item": []
                        },
                        {
                            "name": "1.1 Create Subscriber A (User)",
                            "event": [
                                {
                                    "listen": "test",
                                    "script": {
                                        "exec": [
                                            "var jsonData = pm.response.json();",
                                            "if (jsonData.user && jsonData.user.id) {",
                                            "    pm.collectionVariables.set('SUBSCRIBER_A_ID', jsonData.user.id);",
                                            "    pm.test('Subscriber A created successfully', function() {",
                                            "        pm.expect(jsonData.user.email).to.equal('subscriber.a@test.com');",
                                            "    });",
                                            "}"
                                        ],
                                        "type": "text/javascript"
                                    }
                                }
                            ],
                            "request": {
                                "method": "POST",
                                "header": [{"key": "Content-Type", "value": "application/json"}],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"email\": \"subscriber.a@test.com\",\n    \"username\": \"subscriber_a\",\n    \"fullName\": \"Subscriber A - Test User\"\n}"
                                },
                                "url": {
                                    "raw": "{{base_url}}/users",
                                    "host": ["{{base_url}}"],
                                    "path": ["users"]
                                }
                            }
                        },
                        {
                            "name": "1.2 Create Subscriber B (User)",
                            "event": [
                                {
                                    "listen": "test",
                                    "script": {
                                        "exec": [
                                            "var jsonData = pm.response.json();",
                                            "if (jsonData.user && jsonData.user.id) {",
                                            "    pm.collectionVariables.set('SUBSCRIBER_B_ID', jsonData.user.id);",
                                            "    pm.test('Subscriber B created successfully', function() {",
                                            "        pm.expect(jsonData.user.email).to.equal('subscriber.b@test.com');",
                                            "    });",
                                            "}"
                                        ],
                                        "type": "text/javascript"
                                    }
                                }
                            ],
                            "request": {
                                "method": "POST",
                                "header": [{"key": "Content-Type", "value": "application/json"}],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"email\": \"subscriber.b@test.com\",\n    \"username\": \"subscriber_b\",\n    \"fullName\": \"Subscriber B - Test User\"\n}"
                                },
                                "url": {
                                    "raw": "{{base_url}}/users",
                                    "host": ["{{base_url}}"],
                                    "path": ["users"]
                                }
                            }
                        },
                        {
                            "name": "1.3 Create Provider 1 User",
                            "event": [
                                {
                                    "listen": "test",
                                    "script": {
                                        "exec": [
                                            "var jsonData = pm.response.json();",
                                            "if (jsonData.user && jsonData.user.id) {",
                                            "    pm.collectionVariables.set('PROVIDER_1_USER_ID', jsonData.user.id);",
                                            "    pm.test('Provider 1 user created', function() {",
                                            "        pm.expect(jsonData.user.email).to.equal('provider1@lawfirm.com');",
                                            "    });",
                                            "}"
                                        ],
                                        "type": "text/javascript"
                                    }
                                }
                            ],
                            "request": {
                                "method": "POST",
                                "header": [{"key": "Content-Type", "value": "application/json"}],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"email\": \"provider1@lawfirm.com\",\n    \"username\": \"provider_1\",\n    \"fullName\": \"Ahmed Al-Rashid - Senior Lawyer\"\n}"
                                },
                                "url": {
                                    "raw": "{{base_url}}/users",
                                    "host": ["{{base_url}}"],
                                    "path": ["users"]
                                }
                            }
                        },
                        {
                            "name": "1.4 Create Provider 2 User",
                            "event": [
                                {
                                    "listen": "test",
                                    "script": {
                                        "exec": [
                                            "var jsonData = pm.response.json();",
                                            "if (jsonData.user && jsonData.user.id) {",
                                            "    pm.collectionVariables.set('PROVIDER_2_USER_ID', jsonData.user.id);",
                                            "    pm.test('Provider 2 user created', function() {",
                                            "        pm.expect(jsonData.user.email).to.equal('provider2@lawfirm.com');",
                                            "    });",
                                            "}"
                                        ],
                                        "type": "text/javascript"
                                    }
                                }
                            ],
                            "request": {
                                "method": "POST",
                                "header": [{"key": "Content-Type", "value": "application/json"}],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"email\": \"provider2@lawfirm.com\",\n    \"username\": \"provider_2\",\n    \"fullName\": \"Fatima Hassan - Legal Consultant\"\n}"
                                },
                                "url": {
                                    "raw": "{{base_url}}/users",
                                    "host": ["{{base_url}}"],
                                    "path": ["users"]
                                }
                            }
                        },
                        {
                            "name": "=== PHASE 2: ASSIGN ROLES ===",
                            "item": []
                        },
                        {
                            "name": "2.1 Assign 'user' role to Subscriber A",
                            "event": [
                                {
                                    "listen": "test",
                                    "script": {
                                        "exec": [
                                            "pm.test('Role assigned to Subscriber A', function() {",
                                            "    pm.response.to.have.status(200);",
                                            "});"
                                        ],
                                        "type": "text/javascript"
                                    }
                                }
                            ],
                            "request": {
                                "method": "POST",
                                "header": [{"key": "Content-Type", "value": "application/json"}],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"roleName\": \"user\"\n}"
                                },
                                "url": {
                                    "raw": "{{base_url}}/admin/roles/users/{{SUBSCRIBER_A_ID}}/roles",
                                    "host": ["{{base_url}}"],
                                    "path": ["admin", "roles", "users", "{{SUBSCRIBER_A_ID}}", "roles"]
                                }
                            }
                        },
                        {
                            "name": "2.2 Assign 'user' role to Subscriber B",
                            "request": {
                                "method": "POST",
                                "header": [{"key": "Content-Type", "value": "application/json"}],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"roleName\": \"user\"\n}"
                                },
                                "url": {
                                    "raw": "{{base_url}}/admin/roles/users/{{SUBSCRIBER_B_ID}}/roles",
                                    "host": ["{{base_url}}"],
                                    "path": ["admin", "roles", "users", "{{SUBSCRIBER_B_ID}}", "roles"]
                                }
                            }
                        },
                        {
                            "name": "2.3 Assign 'provider' role to Provider 1",
                            "request": {
                                "method": "POST",
                                "header": [{"key": "Content-Type", "value": "application/json"}],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"roleName\": \"provider\"\n}"
                                },
                                "url": {
                                    "raw": "{{base_url}}/admin/roles/users/{{PROVIDER_1_USER_ID}}/roles",
                                    "host": ["{{base_url}}"],
                                    "path": ["admin", "roles", "users", "{{PROVIDER_1_USER_ID}}", "roles"]
                                }
                            }
                        },
                        {
                            "name": "2.4 Assign 'provider' role to Provider 2",
                            "request": {
                                "method": "POST",
                                "header": [{"key": "Content-Type", "value": "application/json"}],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"roleName\": \"provider\"\n}"
                                },
                                "url": {
                                    "raw": "{{base_url}}/admin/roles/users/{{PROVIDER_2_USER_ID}}/roles",
                                    "host": ["{{base_url}}"],
                                    "path": ["admin", "roles", "users", "{{PROVIDER_2_USER_ID}}", "roles"]
                                }
                            }
                        },
                        {
                            "name": "=== PHASE 3: CREATE PROVIDER PROFILES ===",
                            "item": []
                        },
                        {
                            "name": "3.1 Create Provider 1 Profile",
                            "event": [
                                {
                                    "listen": "test",
                                    "script": {
                                        "exec": [
                                            "var jsonData = pm.response.json();",
                                            "if (jsonData.id) {",
                                            "    pm.collectionVariables.set('PROVIDER_1_PROFILE_ID', jsonData.id);",
                                            "    pm.test('Provider 1 profile created', function() {",
                                            "        pm.expect(jsonData.organizationName).to.equal('Al-Rashid Law Firm');",
                                            "    });",
                                            "}"
                                        ],
                                        "type": "text/javascript"
                                    }
                                }
                            ],
                            "request": {
                                "method": "POST",
                                "header": [{"key": "Content-Type", "value": "application/json"}],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"userId\": \"{{PROVIDER_1_USER_ID}}\",\n    \"organizationName\": \"Al-Rashid Law Firm\",\n    \"organizationNameAr\": \"مكتب الراشد للمحاماة\",\n    \"licenseNumber\": \"LAW-2024-001\",\n    \"taxNumber\": \"TAX-001-2024\",\n    \"description\": \"Specialized in corporate law and commercial disputes\",\n    \"descriptionAr\": \"متخصصون في القانون التجاري والنزاعات التجارية\",\n    \"businessEmail\": \"info@alrashid-law.com\",\n    \"businessPhone\": \"+966501234567\"\n}"
                                },
                                "url": {
                                    "raw": "{{base_url}}/provider-profiles",
                                    "host": ["{{base_url}}"],
                                    "path": ["provider-profiles"]
                                }
                            }
                        },
                        {
                            "name": "3.2 Create Provider 2 Profile",
                            "event": [
                                {
                                    "listen": "test",
                                    "script": {
                                        "exec": [
                                            "var jsonData = pm.response.json();",
                                            "if (jsonData.id) {",
                                            "    pm.collectionVariables.set('PROVIDER_2_PROFILE_ID', jsonData.id);",
                                            "    pm.test('Provider 2 profile created', function() {",
                                            "        pm.expect(jsonData.organizationName).to.equal('Hassan Legal Consultancy');",
                                            "    });",
                                            "}"
                                        ],
                                        "type": "text/javascript"
                                    }
                                }
                            ],
                            "request": {
                                "method": "POST",
                                "header": [{"key": "Content-Type", "value": "application/json"}],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"userId\": \"{{PROVIDER_2_USER_ID}}\",\n    \"organizationName\": \"Hassan Legal Consultancy\",\n    \"organizationNameAr\": \"حسن للاستشارات القانونية\",\n    \"licenseNumber\": \"LAW-2024-002\",\n    \"taxNumber\": \"TAX-002-2024\",\n    \"description\": \"Family law and civil litigation experts\",\n    \"descriptionAr\": \"خبراء في قانون الأسرة والتقاضي المدني\",\n    \"businessEmail\": \"info@hassan-legal.com\",\n    \"businessPhone\": \"+966509876543\"\n}"
                                },
                                "url": {
                                    "raw": "{{base_url}}/provider-profiles",
                                    "host": ["{{base_url}}"],
                                    "path": ["provider-profiles"]
                                }
                            }
                        },
                        {
                            "name": "3.3 Approve Provider 1 Profile (Admin)",
                            "event": [
                                {
                                    "listen": "test",
                                    "script": {
                                        "exec": [
                                            "pm.test('Provider 1 approved', function() {",
                                            "    var jsonData = pm.response.json();",
                                            "    pm.expect(jsonData.verificationStatus).to.equal('approved');",
                                            "});"
                                        ],
                                        "type": "text/javascript"
                                    }
                                }
                            ],
                            "request": {
                                "method": "POST",
                                "header": [{"key": "Content-Type", "value": "application/json"}],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{}"
                                },
                                "url": {
                                    "raw": "{{base_url}}/provider-profiles/{{PROVIDER_1_PROFILE_ID}}/approve",
                                    "host": ["{{base_url}}"],
                                    "path": ["provider-profiles", "{{PROVIDER_1_PROFILE_ID}}", "approve"]
                                }
                            }
                        },
                        {
                            "name": "3.4 Approve Provider 2 Profile (Admin)",
                            "event": [
                                {
                                    "listen": "test",
                                    "script": {
                                        "exec": [
                                            "pm.test('Provider 2 approved', function() {",
                                            "    var jsonData = pm.response.json();",
                                            "    pm.expect(jsonData.verificationStatus).to.equal('approved');",
                                            "});"
                                        ],
                                        "type": "text/javascript"
                                    }
                                }
                            ],
                            "request": {
                                "method": "POST",
                                "header": [{"key": "Content-Type", "value": "application/json"}],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{}"
                                },
                                "url": {
                                    "raw": "{{base_url}}/provider-profiles/{{PROVIDER_2_PROFILE_ID}}/approve",
                                    "host": ["{{base_url}}"],
                                    "path": ["provider-profiles", "{{PROVIDER_2_PROFILE_ID}}", "approve"]
                                }
                            }
                        },
                        {
                            "name": "=== PHASE 4: SETUP ROUTING RULES ===",
                            "item": []
                        },
                        {
                            "name": "4.1 Get Available Request Types",
                            "event": [
                                {
                                    "listen": "test",
                                    "script": {
                                        "exec": [
                                            "pm.test('Request types retrieved', function() {",
                                            "    var jsonData = pm.response.json();",
                                            "    pm.expect(jsonData.requestTypes).to.be.an('array');",
                                            "    pm.expect(jsonData.requestTypes.length).to.be.greaterThan(0);",
                                            "});"
                                        ],
                                        "type": "text/javascript"
                                    }
                                }
                            ],
                            "request": {
                                "method": "GET",
                                "header": [],
                                "url": {
                                    "raw": "{{base_url}}/admin/routing/reference/request-types",
                                    "host": ["{{base_url}}"],
                                    "path": ["admin", "routing", "reference", "request-types"]
                                }
                            }
                        },
                        {
                            "name": "4.2 Get Available Routing Strategies",
                            "event": [
                                {
                                    "listen": "test",
                                    "script": {
                                        "exec": [
                                            "pm.test('Routing strategies retrieved', function() {",
                                            "    var jsonData = pm.response.json();",
                                            "    pm.expect(jsonData.strategies).to.be.an('array');",
                                            "    var strategies = jsonData.strategies.map(s => s.value);",
                                            "    pm.expect(strategies).to.include('round_robin');",
                                            "    pm.expect(strategies).to.include('load_balanced');",
                                            "});"
                                        ],
                                        "type": "text/javascript"
                                    }
                                }
                            ],
                            "request": {
                                "method": "GET",
                                "header": [],
                                "url": {
                                    "raw": "{{base_url}}/admin/routing/reference/strategies",
                                    "host": ["{{base_url}}"],
                                    "path": ["admin", "routing", "reference", "strategies"]
                                }
                            }
                        },
                        {
                            "name": "4.3 Create Round Robin Rule for Consultations",
                            "event": [
                                {
                                    "listen": "test",
                                    "script": {
                                        "exec": [
                                            "var jsonData = pm.response.json();",
                                            "if (jsonData.rule && jsonData.rule.id) {",
                                            "    pm.collectionVariables.set('ROUTING_RULE_RR_ID', jsonData.rule.id);",
                                            "    pm.test('Round Robin rule created', function() {",
                                            "        pm.expect(jsonData.rule.routingStrategy).to.equal('round_robin');",
                                            "        pm.expect(jsonData.rule.requestType).to.equal('consultation');",
                                            "    });",
                                            "}"
                                        ],
                                        "type": "text/javascript"
                                    }
                                }
                            ],
                            "request": {
                                "method": "POST",
                                "header": [{"key": "Content-Type", "value": "application/json"}],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"name\": \"Consultation Round Robin\",\n    \"requestType\": \"consultation\",\n    \"routingStrategy\": \"round_robin\",\n    \"priority\": 100,\n    \"conditions\": {\n        \"categories\": [\"general\", \"commercial\", \"civil\"],\n        \"urgency\": [\"low\", \"normal\", \"high\"]\n    },\n    \"targetProviders\": {\n        \"providerIds\": [\"{{PROVIDER_1_USER_ID}}\", \"{{PROVIDER_2_USER_ID}}\"],\n        \"requireActive\": true\n    },\n    \"isActive\": true\n}"
                                },
                                "url": {
                                    "raw": "{{base_url}}/admin/routing/rules",
                                    "host": ["{{base_url}}"],
                                    "path": ["admin", "routing", "rules"]
                                }
                            }
                        },
                        {
                            "name": "4.4 Create Load Balanced Rule for Legal Opinions",
                            "event": [
                                {
                                    "listen": "test",
                                    "script": {
                                        "exec": [
                                            "var jsonData = pm.response.json();",
                                            "if (jsonData.rule && jsonData.rule.id) {",
                                            "    pm.collectionVariables.set('ROUTING_RULE_LB_ID', jsonData.rule.id);",
                                            "    pm.test('Load Balanced rule created', function() {",
                                            "        pm.expect(jsonData.rule.routingStrategy).to.equal('load_balanced');",
                                            "        pm.expect(jsonData.rule.requestType).to.equal('legal_opinion');",
                                            "    });",
                                            "}"
                                        ],
                                        "type": "text/javascript"
                                    }
                                }
                            ],
                            "request": {
                                "method": "POST",
                                "header": [{"key": "Content-Type", "value": "application/json"}],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"name\": \"Legal Opinion Load Balanced\",\n    \"requestType\": \"legal_opinion\",\n    \"routingStrategy\": \"load_balanced\",\n    \"priority\": 100,\n    \"conditions\": null,\n    \"targetProviders\": {\n        \"requireActive\": true,\n        \"maxActiveRequests\": 10\n    },\n    \"isActive\": true\n}"
                                },
                                "url": {
                                    "raw": "{{base_url}}/admin/routing/rules",
                                    "host": ["{{base_url}}"],
                                    "path": ["admin", "routing", "rules"]
                                }
                            }
                        },
                        {
                            "name": "4.5 List All Routing Rules",
                            "event": [
                                {
                                    "listen": "test",
                                    "script": {
                                        "exec": [
                                            "pm.test('Routing rules listed', function() {",
                                            "    var jsonData = pm.response.json();",
                                            "    pm.expect(jsonData.rules).to.be.an('array');",
                                            "    pm.expect(jsonData.rules.length).to.be.at.least(2);",
                                            "});"
                                        ],
                                        "type": "text/javascript"
                                    }
                                }
                            ],
                            "request": {
                                "method": "GET",
                                "header": [],
                                "url": {
                                    "raw": "{{base_url}}/admin/routing/rules",
                                    "host": ["{{base_url}}"],
                                    "path": ["admin", "routing", "rules"]
                                }
                            }
                        },
                        {
                            "name": "=== PHASE 5: CHECK INITIAL WORKLOAD ===",
                            "item": []
                        },
                        {
                            "name": "5.1 Get Provider Workload (Initial - All Zero)",
                            "event": [
                                {
                                    "listen": "test",
                                    "script": {
                                        "exec": [
                                            "pm.test('Initial workload is zero', function() {",
                                            "    var jsonData = pm.response.json();",
                                            "    pm.expect(jsonData.providers).to.be.an('array');",
                                            "    // All providers should have 0 active requests initially",
                                            "    jsonData.providers.forEach(function(p) {",
                                            "        pm.expect(p.activeRequests).to.equal(0);",
                                            "    });",
                                            "});"
                                        ],
                                        "type": "text/javascript"
                                    }
                                }
                            ],
                            "request": {
                                "method": "GET",
                                "header": [],
                                "url": {
                                    "raw": "{{base_url}}/admin/routing/providers/workload",
                                    "host": ["{{base_url}}"],
                                    "path": ["admin", "routing", "providers", "workload"]
                                }
                            }
                        },
                        {
                            "name": "=== PHASE 6: SUBMIT REQUESTS & TEST AUTO-ASSIGN ===",
                            "item": []
                        },
                        {
                            "name": "6.1 Subscriber A: Create Consultation Request 1",
                            "event": [
                                {
                                    "listen": "test",
                                    "script": {
                                        "exec": [
                                            "var jsonData = pm.response.json();",
                                            "if (jsonData.id) {",
                                            "    pm.collectionVariables.set('CONSULTATION_1_ID', jsonData.id);",
                                            "    pm.test('Consultation 1 created', function() {",
                                            "        pm.expect(jsonData.status).to.equal('pending');",
                                            "    });",
                                            "}"
                                        ],
                                        "type": "text/javascript"
                                    }
                                }
                            ],
                            "request": {
                                "method": "POST",
                                "header": [{"key": "Content-Type", "value": "application/json"}],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"subscriberId\": \"{{SUBSCRIBER_A_ID}}\",\n    \"consultationType\": \"general\",\n    \"category\": \"commercial\",\n    \"subject\": \"Contract Review\",\n    \"description\": \"Need to review a commercial partnership agreement.\",\n    \"urgency\": \"normal\"\n}"
                                },
                                "url": {
                                    "raw": "{{base_url}}/consultation-requests",
                                    "host": ["{{base_url}}"],
                                    "path": ["consultation-requests"]
                                }
                            }
                        },
                        {
                            "name": "6.2 Auto-Assign Consultation 1 (Should go to Provider 1)",
                            "event": [
                                {
                                    "listen": "test",
                                    "script": {
                                        "exec": [
                                            "pm.test('Consultation 1 auto-assigned', function() {",
                                            "    var jsonData = pm.response.json();",
                                            "    pm.expect(jsonData.success).to.equal(true);",
                                            "    pm.expect(jsonData.strategy).to.equal('round_robin');",
                                            "    // Store which provider got it",
                                            "    if (jsonData.providerId) {",
                                            "        pm.collectionVariables.set('ASSIGNED_PROVIDER_1', jsonData.providerId);",
                                            "        console.log('Consultation 1 assigned to: ' + jsonData.providerName);",
                                            "    }",
                                            "});"
                                        ],
                                        "type": "text/javascript"
                                    }
                                }
                            ],
                            "request": {
                                "method": "POST",
                                "header": [{"key": "Content-Type", "value": "application/json"}],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"requestId\": \"{{CONSULTATION_1_ID}}\",\n    \"requestType\": \"consultation\",\n    \"category\": \"commercial\",\n    \"urgency\": \"normal\",\n    \"subscriberId\": \"{{SUBSCRIBER_A_ID}}\"\n}"
                                },
                                "url": {
                                    "raw": "{{base_url}}/admin/routing/auto-assign",
                                    "host": ["{{base_url}}"],
                                    "path": ["admin", "routing", "auto-assign"]
                                }
                            }
                        },
                        {
                            "name": "6.3 Subscriber B: Create Consultation Request 2",
                            "event": [
                                {
                                    "listen": "test",
                                    "script": {
                                        "exec": [
                                            "var jsonData = pm.response.json();",
                                            "if (jsonData.id) {",
                                            "    pm.collectionVariables.set('CONSULTATION_2_ID', jsonData.id);",
                                            "    pm.test('Consultation 2 created', function() {",
                                            "        pm.expect(jsonData.status).to.equal('pending');",
                                            "    });",
                                            "}"
                                        ],
                                        "type": "text/javascript"
                                    }
                                }
                            ],
                            "request": {
                                "method": "POST",
                                "header": [{"key": "Content-Type", "value": "application/json"}],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"subscriberId\": \"{{SUBSCRIBER_B_ID}}\",\n    \"consultationType\": \"general\",\n    \"category\": \"civil\",\n    \"subject\": \"Property Dispute\",\n    \"description\": \"Need advice on a property boundary dispute with neighbor.\",\n    \"urgency\": \"high\"\n}"
                                },
                                "url": {
                                    "raw": "{{base_url}}/consultation-requests",
                                    "host": ["{{base_url}}"],
                                    "path": ["consultation-requests"]
                                }
                            }
                        },
                        {
                            "name": "6.4 Auto-Assign Consultation 2 (Round Robin: Should go to Provider 2)",
                            "event": [
                                {
                                    "listen": "test",
                                    "script": {
                                        "exec": [
                                            "pm.test('Consultation 2 auto-assigned (round robin rotates)', function() {",
                                            "    var jsonData = pm.response.json();",
                                            "    pm.expect(jsonData.success).to.equal(true);",
                                            "    pm.expect(jsonData.strategy).to.equal('round_robin');",
                                            "    // Should go to different provider than consultation 1",
                                            "    var firstProvider = pm.collectionVariables.get('ASSIGNED_PROVIDER_1');",
                                            "    if (firstProvider && jsonData.providerId) {",
                                            "        pm.expect(jsonData.providerId).to.not.equal(firstProvider);",
                                            "        console.log('Consultation 2 assigned to: ' + jsonData.providerName + ' (different from first)');",
                                            "    }",
                                            "});"
                                        ],
                                        "type": "text/javascript"
                                    }
                                }
                            ],
                            "request": {
                                "method": "POST",
                                "header": [{"key": "Content-Type", "value": "application/json"}],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"requestId\": \"{{CONSULTATION_2_ID}}\",\n    \"requestType\": \"consultation\",\n    \"category\": \"civil\",\n    \"urgency\": \"high\",\n    \"subscriberId\": \"{{SUBSCRIBER_B_ID}}\"\n}"
                                },
                                "url": {
                                    "raw": "{{base_url}}/admin/routing/auto-assign",
                                    "host": ["{{base_url}}"],
                                    "path": ["admin", "routing", "auto-assign"]
                                }
                            }
                        },
                        {
                            "name": "6.5 Subscriber A: Create Consultation Request 3",
                            "event": [
                                {
                                    "listen": "test",
                                    "script": {
                                        "exec": [
                                            "var jsonData = pm.response.json();",
                                            "if (jsonData.id) {",
                                            "    pm.collectionVariables.set('CONSULTATION_3_ID', jsonData.id);",
                                            "}"
                                        ],
                                        "type": "text/javascript"
                                    }
                                }
                            ],
                            "request": {
                                "method": "POST",
                                "header": [{"key": "Content-Type", "value": "application/json"}],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"subscriberId\": \"{{SUBSCRIBER_A_ID}}\",\n    \"consultationType\": \"general\",\n    \"category\": \"general\",\n    \"subject\": \"Employment Question\",\n    \"description\": \"Need advice about employment termination rights.\",\n    \"urgency\": \"normal\"\n}"
                                },
                                "url": {
                                    "raw": "{{base_url}}/consultation-requests",
                                    "host": ["{{base_url}}"],
                                    "path": ["consultation-requests"]
                                }
                            }
                        },
                        {
                            "name": "6.6 Auto-Assign Consultation 3 (Round Robin: Back to Provider 1)",
                            "event": [
                                {
                                    "listen": "test",
                                    "script": {
                                        "exec": [
                                            "pm.test('Consultation 3 auto-assigned (round robin continues)', function() {",
                                            "    var jsonData = pm.response.json();",
                                            "    pm.expect(jsonData.success).to.equal(true);",
                                            "    // Should cycle back to first provider",
                                            "    var firstProvider = pm.collectionVariables.get('ASSIGNED_PROVIDER_1');",
                                            "    if (firstProvider && jsonData.providerId) {",
                                            "        pm.expect(jsonData.providerId).to.equal(firstProvider);",
                                            "        console.log('Consultation 3 assigned to: ' + jsonData.providerName + ' (cycled back)');",
                                            "    }",
                                            "});"
                                        ],
                                        "type": "text/javascript"
                                    }
                                }
                            ],
                            "request": {
                                "method": "POST",
                                "header": [{"key": "Content-Type", "value": "application/json"}],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"requestId\": \"{{CONSULTATION_3_ID}}\",\n    \"requestType\": \"consultation\",\n    \"category\": \"general\",\n    \"urgency\": \"normal\",\n    \"subscriberId\": \"{{SUBSCRIBER_A_ID}}\"\n}"
                                },
                                "url": {
                                    "raw": "{{base_url}}/admin/routing/auto-assign",
                                    "host": ["{{base_url}}"],
                                    "path": ["admin", "routing", "auto-assign"]
                                }
                            }
                        },
                        {
                            "name": "=== PHASE 7: VERIFY WORKLOAD DISTRIBUTION ===",
                            "item": []
                        },
                        {
                            "name": "7.1 Get Provider Workload (After Assignments)",
                            "event": [
                                {
                                    "listen": "test",
                                    "script": {
                                        "exec": [
                                            "pm.test('Workload distributed across providers', function() {",
                                            "    var jsonData = pm.response.json();",
                                            "    pm.expect(jsonData.providers).to.be.an('array');",
                                            "    // Total active requests should be 3",
                                            "    var totalActive = jsonData.providers.reduce(function(sum, p) {",
                                            "        return sum + p.activeRequests;",
                                            "    }, 0);",
                                            "    pm.expect(totalActive).to.equal(3);",
                                            "    console.log('Workload distribution:', jsonData.providers.map(p => p.providerName + ': ' + p.activeRequests).join(', '));",
                                            "});"
                                        ],
                                        "type": "text/javascript"
                                    }
                                }
                            ],
                            "request": {
                                "method": "GET",
                                "header": [],
                                "url": {
                                    "raw": "{{base_url}}/admin/routing/providers/workload",
                                    "host": ["{{base_url}}"],
                                    "path": ["admin", "routing", "providers", "workload"]
                                }
                            }
                        },
                        {
                            "name": "7.2 Get Routing Statistics",
                            "event": [
                                {
                                    "listen": "test",
                                    "script": {
                                        "exec": [
                                            "pm.test('Routing stats available', function() {",
                                            "    var jsonData = pm.response.json();",
                                            "    pm.expect(jsonData.stats).to.be.an('object');",
                                            "    pm.expect(jsonData.stats.totalRules).to.be.at.least(2);",
                                            "    pm.expect(jsonData.stats.activeRules).to.be.at.least(2);",
                                            "});"
                                        ],
                                        "type": "text/javascript"
                                    }
                                }
                            ],
                            "request": {
                                "method": "GET",
                                "header": [],
                                "url": {
                                    "raw": "{{base_url}}/admin/routing/stats",
                                    "host": ["{{base_url}}"],
                                    "path": ["admin", "routing", "stats"]
                                }
                            }
                        },
                        {
                            "name": "=== PHASE 8: TEST RULE MATCHING ===",
                            "item": []
                        },
                        {
                            "name": "8.1 Test Rule Matching for Consultation",
                            "event": [
                                {
                                    "listen": "test",
                                    "script": {
                                        "exec": [
                                            "pm.test('Rule matching works correctly', function() {",
                                            "    var jsonData = pm.response.json();",
                                            "    pm.expect(jsonData.matchingRule).to.not.be.null;",
                                            "    pm.expect(jsonData.matchingRule.routingStrategy).to.equal('round_robin');",
                                            "    pm.expect(jsonData.evaluatedRules).to.be.an('array');",
                                            "});"
                                        ],
                                        "type": "text/javascript"
                                    }
                                }
                            ],
                            "request": {
                                "method": "POST",
                                "header": [{"key": "Content-Type", "value": "application/json"}],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"requestType\": \"consultation\",\n    \"category\": \"commercial\",\n    \"urgency\": \"normal\"\n}"
                                },
                                "url": {
                                    "raw": "{{base_url}}/admin/routing/rules/test",
                                    "host": ["{{base_url}}"],
                                    "path": ["admin", "routing", "rules", "test"]
                                }
                            }
                        },
                        {
                            "name": "8.2 Test Rule Matching for Legal Opinion",
                            "event": [
                                {
                                    "listen": "test",
                                    "script": {
                                        "exec": [
                                            "pm.test('Legal opinion rule matches', function() {",
                                            "    var jsonData = pm.response.json();",
                                            "    pm.expect(jsonData.matchingRule).to.not.be.null;",
                                            "    pm.expect(jsonData.matchingRule.routingStrategy).to.equal('load_balanced');",
                                            "});"
                                        ],
                                        "type": "text/javascript"
                                    }
                                }
                            ],
                            "request": {
                                "method": "POST",
                                "header": [{"key": "Content-Type", "value": "application/json"}],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"requestType\": \"legal_opinion\"\n}"
                                },
                                "url": {
                                    "raw": "{{base_url}}/admin/routing/rules/test",
                                    "host": ["{{base_url}}"],
                                    "path": ["admin", "routing", "rules", "test"]
                                }
                            }
                        },
                        {
                            "name": "=== PHASE 9: TEST REASSIGNMENT ===",
                            "item": []
                        },
                        {
                            "name": "9.1 Reassign Consultation 1 to Provider 2",
                            "event": [
                                {
                                    "listen": "test",
                                    "script": {
                                        "exec": [
                                            "pm.test('Reassignment successful', function() {",
                                            "    var jsonData = pm.response.json();",
                                            "    pm.expect(jsonData.success).to.equal(true);",
                                            "    pm.expect(jsonData.providerId).to.equal(pm.collectionVariables.get('PROVIDER_2_USER_ID'));",
                                            "});"
                                        ],
                                        "type": "text/javascript"
                                    }
                                }
                            ],
                            "request": {
                                "method": "POST",
                                "header": [{"key": "Content-Type", "value": "application/json"}],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"requestId\": \"{{CONSULTATION_1_ID}}\",\n    \"requestType\": \"consultation\",\n    \"newProviderId\": \"{{PROVIDER_2_USER_ID}}\",\n    \"reason\": \"Client requested specific provider\"\n}"
                                },
                                "url": {
                                    "raw": "{{base_url}}/admin/routing/reassign",
                                    "host": ["{{base_url}}"],
                                    "path": ["admin", "routing", "reassign"]
                                }
                            }
                        },
                        {
                            "name": "9.2 Verify Workload After Reassignment",
                            "event": [
                                {
                                    "listen": "test",
                                    "script": {
                                        "exec": [
                                            "pm.test('Workload updated after reassignment', function() {",
                                            "    var jsonData = pm.response.json();",
                                            "    console.log('Workload after reassignment:', jsonData.providers.map(p => p.providerName + ': ' + p.activeRequests).join(', '));",
                                            "});"
                                        ],
                                        "type": "text/javascript"
                                    }
                                }
                            ],
                            "request": {
                                "method": "GET",
                                "header": [],
                                "url": {
                                    "raw": "{{base_url}}/admin/routing/providers/workload",
                                    "host": ["{{base_url}}"],
                                    "path": ["admin", "routing", "providers", "workload"]
                                }
                            }
                        },
                        {
                            "name": "=== PHASE 10: RULE MANAGEMENT ===",
                            "item": []
                        },
                        {
                            "name": "10.1 Deactivate Round Robin Rule",
                            "event": [
                                {
                                    "listen": "test",
                                    "script": {
                                        "exec": [
                                            "pm.test('Rule deactivated', function() {",
                                            "    var jsonData = pm.response.json();",
                                            "    pm.expect(jsonData.rule.isActive).to.equal(false);",
                                            "});"
                                        ],
                                        "type": "text/javascript"
                                    }
                                }
                            ],
                            "request": {
                                "method": "PATCH",
                                "header": [],
                                "url": {
                                    "raw": "{{base_url}}/admin/routing/rules/{{ROUTING_RULE_RR_ID}}/deactivate",
                                    "host": ["{{base_url}}"],
                                    "path": ["admin", "routing", "rules", "{{ROUTING_RULE_RR_ID}}", "deactivate"]
                                }
                            }
                        },
                        {
                            "name": "10.2 Re-activate Round Robin Rule",
                            "event": [
                                {
                                    "listen": "test",
                                    "script": {
                                        "exec": [
                                            "pm.test('Rule re-activated', function() {",
                                            "    var jsonData = pm.response.json();",
                                            "    pm.expect(jsonData.rule.isActive).to.equal(true);",
                                            "});"
                                        ],
                                        "type": "text/javascript"
                                    }
                                }
                            ],
                            "request": {
                                "method": "PATCH",
                                "header": [],
                                "url": {
                                    "raw": "{{base_url}}/admin/routing/rules/{{ROUTING_RULE_RR_ID}}/activate",
                                    "host": ["{{base_url}}"],
                                    "path": ["admin", "routing", "rules", "{{ROUTING_RULE_RR_ID}}", "activate"]
                                }
                            }
                        },
                        {
                            "name": "10.3 Update Rule Priority",
                            "event": [
                                {
                                    "listen": "test",
                                    "script": {
                                        "exec": [
                                            "pm.test('Rule priority updated', function() {",
                                            "    var jsonData = pm.response.json();",
                                            "    pm.expect(jsonData.rule.priority).to.equal(200);",
                                            "});"
                                        ],
                                        "type": "text/javascript"
                                    }
                                }
                            ],
                            "request": {
                                "method": "PUT",
                                "header": [{"key": "Content-Type", "value": "application/json"}],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"priority\": 200\n}"
                                },
                                "url": {
                                    "raw": "{{base_url}}/admin/routing/rules/{{ROUTING_RULE_RR_ID}}",
                                    "host": ["{{base_url}}"],
                                    "path": ["admin", "routing", "rules", "{{ROUTING_RULE_RR_ID}}"]
                                }
                            }
                        },
                        {
                            "name": "=== SUMMARY ===",
                            "item": []
                        },
                        {
                            "name": "Final: Get All Active Rules Summary",
                            "event": [
                                {
                                    "listen": "test",
                                    "script": {
                                        "exec": [
                                            "pm.test('Scenario completed successfully', function() {",
                                            "    var jsonData = pm.response.json();",
                                            "    console.log('=== ROUTING TEST SCENARIO COMPLETE ===');",
                                            "    console.log('Total Rules: ' + jsonData.total);",
                                            "    console.log('Active Rules: ' + jsonData.rules.filter(r => r.isActive).length);",
                                            "    console.log('');",
                                            "    console.log('Test Summary:');",
                                            "    console.log('- Created 2 subscribers and 2 providers');",
                                            "    console.log('- Set up Round Robin rule for consultations');",
                                            "    console.log('- Set up Load Balanced rule for legal opinions');",
                                            "    console.log('- Verified auto-assignment rotates correctly');",
                                            "    console.log('- Tested manual reassignment');",
                                            "    console.log('- Verified workload tracking');",
                                            "});"
                                        ],
                                        "type": "text/javascript"
                                    }
                                }
                            ],
                            "request": {
                                "method": "GET",
                                "header": [],
                                "url": {
                                    "raw": "{{base_url}}/admin/routing/rules?isActive=true",
                                    "host": ["{{base_url}}"],
                                    "path": ["admin", "routing", "rules"],
                                    "query": [{"key": "isActive", "value": "true"}]
                                }
                            }
                        }
                    ]
                }
            ]
        },
        {
            "name": "Membership Tiers",
            "description": "Manage membership tiers",
            "item": [
                {
                    "name": "List All Tiers",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/memberships/tiers",
                            "host": ["{{base_url}}"],
                            "path": ["memberships", "tiers"]
                        }
                    }
                },
                {
                    "name": "Get Tier by ID",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/memberships/tiers/{{TIER_ID}}",
                            "host": ["{{base_url}}"],
                            "path": ["memberships", "tiers", "{{TIER_ID}}"]
                        }
                    }
                },
                {
                    "name": "Create Tier",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"name\": \"Enterprise Plan\",\n    \"nameAr\": \"خطة المؤسسات\",\n    \"description\": \"Enterprise membership for businesses\",\n    \"descriptionAr\": \"عضوية المؤسسات للشركات\",\n    \"price\": 1000,\n    \"currency\": \"SAR\",\n    \"billingCycle\": \"monthly\",\n    \"quota\": {\n        \"consultationsPerMonth\": 20,\n        \"opinionsPerMonth\": 10,\n        \"casesPerMonth\": 5,\n        \"callMinutesPerMonth\": 120\n    },\n    \"benefits\": [\n        \"Dedicated account manager\",\n        \"Priority support 24/7\",\n        \"Unlimited document storage\"\n    ],\n    \"isActive\": true\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/memberships/tiers",
                            "host": ["{{base_url}}"],
                            "path": ["memberships", "tiers"]
                        }
                    }
                },
                {
                    "name": "Update Tier",
                    "request": {
                        "method": "PUT",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"name\": \"Enterprise Plan Updated\",\n    \"price\": 1200,\n    \"quota\": {\n        \"consultationsPerMonth\": 25\n    }\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/memberships/tiers/{{TIER_ID}}",
                            "host": ["{{base_url}}"],
                            "path": ["memberships", "tiers", "{{TIER_ID}}"]
                        }
                    }
                },
                {
                    "name": "Delete Tier",
                    "request": {
                        "method": "DELETE",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/memberships/tiers/{{TIER_ID}}",
                            "host": ["{{base_url}}"],
                            "path": ["memberships", "tiers", "{{TIER_ID}}"]
                        }
                    }
                }
            ]
        },
        {
            "name": "Memberships",
            "description": "Manage user memberships",
            "item": [
                {
                    "name": "Create Membership",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"userId\": \"{{USER_ID}}\",\n    \"tierId\": {{TIER_ID}},\n    \"durationInMonths\": 12,\n    \"autoRenew\": true\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/memberships",
                            "host": ["{{base_url}}"],
                            "path": ["memberships"]
                        }
                    }
                },
                {
                    "name": "Get My Membership",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/memberships/me",
                            "host": ["{{base_url}}"],
                            "path": ["memberships", "me"]
                        }
                    }
                },
                {
                    "name": "Get Membership by ID",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/memberships/{{MEMBERSHIP_ID}}",
                            "host": ["{{base_url}}"],
                            "path": ["memberships", "{{MEMBERSHIP_ID}}"]
                        }
                    }
                },
                {
                    "name": "Get User Membership",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/memberships/user/{{USER_ID}}",
                            "host": ["{{base_url}}"],
                            "path": ["memberships", "user", "{{USER_ID}}"]
                        }
                    }
                },
                {
                    "name": "Cancel Membership",
                    "request": {
                        "method": "DELETE",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/memberships/{{MEMBERSHIP_ID}}",
                            "host": ["{{base_url}}"],
                            "path": ["memberships", "{{MEMBERSHIP_ID}}"]
                        }
                    }
                },
                {
                    "name": "Renew Membership",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"durationInMonths\": 12\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/memberships/{{MEMBERSHIP_ID}}/renew",
                            "host": ["{{base_url}}"],
                            "path": ["memberships", "{{MEMBERSHIP_ID}}", "renew"]
                        }
                    }
                },
                {
                    "name": "Toggle Auto-Renew",
                    "request": {
                        "method": "PATCH",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"autoRenew\": false\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/memberships/{{MEMBERSHIP_ID}}/auto-renew",
                            "host": ["{{base_url}}"],
                            "path": ["memberships", "{{MEMBERSHIP_ID}}", "auto-renew"]
                        }
                    }
                },
                {
                    "name": "Upgrade Membership",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"newTierId\": 2\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/memberships/{{MEMBERSHIP_ID}}/upgrade",
                            "host": ["{{base_url}}"],
                            "path": ["memberships", "{{MEMBERSHIP_ID}}", "upgrade"]
                        }
                    }
                },
                {
                    "name": "Downgrade Membership",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"newTierId\": 1\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/memberships/{{MEMBERSHIP_ID}}/downgrade",
                            "host": ["{{base_url}}"],
                            "path": ["memberships", "{{MEMBERSHIP_ID}}", "downgrade"]
                        }
                    }
                },
                {
                    "name": "Pause Membership",
                    "request": {
                        "method": "POST",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/memberships/{{MEMBERSHIP_ID}}/pause",
                            "host": ["{{base_url}}"],
                            "path": ["memberships", "{{MEMBERSHIP_ID}}", "pause"]
                        }
                    }
                },
                {
                    "name": "Resume Membership",
                    "request": {
                        "method": "POST",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/memberships/{{MEMBERSHIP_ID}}/resume",
                            "host": ["{{base_url}}"],
                            "path": ["memberships", "{{MEMBERSHIP_ID}}", "resume"]
                        }
                    }
                },
                {
                    "name": "Check Membership Status",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/memberships/{{MEMBERSHIP_ID}}/status",
                            "host": ["{{base_url}}"],
                            "path": ["memberships", "{{MEMBERSHIP_ID}}", "status"]
                        }
                    }
                },
                {
                    "name": "Get Change History",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/memberships/{{MEMBERSHIP_ID}}/change-history",
                            "host": ["{{base_url}}"],
                            "path": ["memberships", "{{MEMBERSHIP_ID}}", "change-history"]
                        }
                    }
                }
            ]
        },
        {
            "name": "Membership Quota",
            "description": "Manage and consume quota",
            "item": [
                {
                    "name": "Check Consultations Quota",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/memberships/{{MEMBERSHIP_ID}}/quota/consultations",
                            "host": ["{{base_url}}"],
                            "path": ["memberships", "{{MEMBERSHIP_ID}}", "quota", "consultations"]
                        }
                    }
                },
                {
                    "name": "Check Legal Opinions Quota",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/memberships/{{MEMBERSHIP_ID}}/quota/opinions",
                            "host": ["{{base_url}}"],
                            "path": ["memberships", "{{MEMBERSHIP_ID}}", "quota", "opinions"]
                        }
                    }
                },
                {
                    "name": "Check Litigation Cases Quota",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/memberships/{{MEMBERSHIP_ID}}/quota/cases",
                            "host": ["{{base_url}}"],
                            "path": ["memberships", "{{MEMBERSHIP_ID}}", "quota", "cases"]
                        }
                    }
                },
                {
                    "name": "Check Call Minutes Quota",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/memberships/{{MEMBERSHIP_ID}}/quota/callMinutes",
                            "host": ["{{base_url}}"],
                            "path": ["memberships", "{{MEMBERSHIP_ID}}", "quota", "callMinutes"]
                        }
                    }
                },
                {
                    "name": "Consume Consultations",
                    "request": {
                        "method": "PUT",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"amount\": 1\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/memberships/{{MEMBERSHIP_ID}}/quota/consultations/consume",
                            "host": ["{{base_url}}"],
                            "path": ["memberships", "{{MEMBERSHIP_ID}}", "quota", "consultations", "consume"]
                        }
                    }
                },
                {
                    "name": "Consume Legal Opinions",
                    "request": {
                        "method": "PUT",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"amount\": 1\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/memberships/{{MEMBERSHIP_ID}}/quota/opinions/consume",
                            "host": ["{{base_url}}"],
                            "path": ["memberships", "{{MEMBERSHIP_ID}}", "quota", "opinions", "consume"]
                        }
                    }
                },
                {
                    "name": "Consume Call Minutes",
                    "request": {
                        "method": "PUT",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"amount\": 15\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/memberships/{{MEMBERSHIP_ID}}/quota/callMinutes/consume",
                            "host": ["{{base_url}}"],
                            "path": ["memberships", "{{MEMBERSHIP_ID}}", "quota", "callMinutes", "consume"]
                        }
                    }
                }
            ]
        },
        {
            "name": "Billing & Invoices",
            "description": "Manage billing and invoices",
            "item": [
                {
                    "name": "Create Invoice",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"membershipId\": \"{{MEMBERSHIP_ID}}\",\n    \"amount\": 500,\n    \"currency\": \"SAR\",\n    \"dueDate\": \"2025-12-31\",\n    \"description\": \"Monthly subscription - Premium Plan\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/billing/invoices",
                            "host": ["{{base_url}}"],
                            "path": ["billing", "invoices"]
                        }
                    }
                },
                {
                    "name": "Get Invoice by ID",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/billing/invoices/{{INVOICE_ID}}",
                            "host": ["{{base_url}}"],
                            "path": ["billing", "invoices", "{{INVOICE_ID}}"]
                        }
                    }
                },
                {
                    "name": "List User Invoices",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/billing/invoices/user/{{USER_ID}}",
                            "host": ["{{base_url}}"],
                            "path": ["billing", "invoices", "user", "{{USER_ID}}"]
                        }
                    }
                },
                {
                    "name": "Process Payment",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"invoiceId\": \"{{INVOICE_ID}}\",\n    \"provider\": \"stripe\",\n    \"amount\": 500,\n    \"currency\": \"SAR\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/memberships/{{MEMBERSHIP_ID}}/payments",
                            "host": ["{{base_url}}"],
                            "path": ["memberships", "{{MEMBERSHIP_ID}}", "payments"]
                        }
                    }
                },
                {
                    "name": "Complete Payment",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"providerTxnId\": \"txn_stripe_123456\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/memberships/payments/{{PAYMENT_ID}}/complete",
                            "host": ["{{base_url}}"],
                            "path": ["memberships", "payments", "{{PAYMENT_ID}}", "complete"]
                        }
                    }
                }
            ]
        },
        {
            "name": "Notifications",
            "description": "Manage user notifications",
            "item": [
                {
                    "name": "Get User Notifications",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/notifications/user/{{USER_ID}}",
                            "host": ["{{base_url}}"],
                            "path": ["notifications", "user", "{{USER_ID}}"]
                        }
                    }
                },
                {
                    "name": "Get Unread Notifications",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/notifications/user/{{USER_ID}}/unread",
                            "host": ["{{base_url}}"],
                            "path": ["notifications", "user", "{{USER_ID}}", "unread"]
                        }
                    }
                },
                {
                    "name": "Mark as Read",
                    "request": {
                        "method": "PATCH",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/notifications/{{notification_id}}/read",
                            "host": ["{{base_url}}"],
                            "path": ["notifications", "{{notification_id}}", "read"]
                        }
                    }
                },
                {
                    "name": "Mark All as Read",
                    "request": {
                        "method": "PATCH",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/notifications/user/{{USER_ID}}/read-all",
                            "host": ["{{base_url}}"],
                            "path": ["notifications", "user", "{{USER_ID}}", "read-all"]
                        }
                    }
                }
            ]
        },
        {
            "name": "Call Requests",
            "description": "Manage call requests between subscribers and providers",
            "item": [
                {
                    "name": "CRUD Operations",
                    "item": [
                        {
                            "name": "Create Call Request",
                            "request": {
                                "method": "POST",
                                "header": [
                                    {
                                        "key": "Content-Type",
                                        "value": "application/json"
                                    }
                                ],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"subscriberId\": \"{{USER_ID}}\",\n    \"purpose\": \"Legal consultation regarding property dispute\",\n    \"consultationType\": \"legal_advice\",\n    \"preferredDate\": \"2025-12-20\",\n    \"preferredTime\": \"14:00\"\n}"
                                },
                                "url": {
                                    "raw": "{{base_url}}/call-requests",
                                    "host": ["{{base_url}}"],
                                    "path": ["call-requests"]
                                }
                            }
                        },
                        {
                            "name": "Get All Call Requests",
                            "request": {
                                "method": "GET",
                                "header": [],
                                "url": {
                                    "raw": "{{base_url}}/call-requests?limit=20&offset=0",
                                    "host": ["{{base_url}}"],
                                    "path": ["call-requests"],
                                    "query": [
                                        {
                                            "key": "limit",
                                            "value": "20"
                                        },
                                        {
                                            "key": "offset",
                                            "value": "0"
                                        }
                                    ]
                                }
                            }
                        },
                        {
                            "name": "Get Call Request by ID",
                            "request": {
                                "method": "GET",
                                "header": [],
                                "url": {
                                    "raw": "{{base_url}}/call-requests/{{CALL_REQUEST_ID}}",
                                    "host": ["{{base_url}}"],
                                    "path": ["call-requests", "{{CALL_REQUEST_ID}}"]
                                }
                            }
                        },
                        {
                            "name": "Cancel Call Request",
                            "request": {
                                "method": "DELETE",
                                "header": [
                                    {
                                        "key": "Content-Type",
                                        "value": "application/json"
                                    }
                                ],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"reason\": \"Schedule conflict\",\n    \"cancelledBy\": \"subscriber\"\n}"
                                },
                                "url": {
                                    "raw": "{{base_url}}/call-requests/{{CALL_REQUEST_ID}}",
                                    "host": ["{{base_url}}"],
                                    "path": ["call-requests", "{{CALL_REQUEST_ID}}"]
                                }
                            }
                        }
                    ]
                },
                {
                    "name": "Provider Operations",
                    "item": [
                        {
                            "name": "Assign Provider",
                            "request": {
                                "method": "POST",
                                "header": [
                                    {
                                        "key": "Content-Type",
                                        "value": "application/json"
                                    }
                                ],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"providerId\": \"{{PROVIDER_ID}}\"\n}"
                                },
                                "url": {
                                    "raw": "{{base_url}}/call-requests/{{CALL_REQUEST_ID}}/assign",
                                    "host": ["{{base_url}}"],
                                    "path": ["call-requests", "{{CALL_REQUEST_ID}}", "assign"]
                                }
                            }
                        }
                    ]
                },
                {
                    "name": "Scheduling",
                    "item": [
                        {
                            "name": "Schedule Call",
                            "request": {
                                "method": "POST",
                                "header": [
                                    {
                                        "key": "Content-Type",
                                        "value": "application/json"
                                    }
                                ],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"scheduledAt\": \"2025-12-20T14:00:00Z\",\n    \"durationMinutes\": 30,\n    \"platform\": \"zoom\",\n    \"callLink\": \"https://zoom.us/j/123456789\"\n}"
                                },
                                "url": {
                                    "raw": "{{base_url}}/call-requests/{{CALL_REQUEST_ID}}/schedule",
                                    "host": ["{{base_url}}"],
                                    "path": ["call-requests", "{{CALL_REQUEST_ID}}", "schedule"]
                                }
                            }
                        },
                        {
                            "name": "Reschedule Call",
                            "request": {
                                "method": "POST",
                                "header": [
                                    {
                                        "key": "Content-Type",
                                        "value": "application/json"
                                    }
                                ],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"newScheduledAt\": \"2025-12-21T15:00:00Z\",\n    \"reason\": \"Provider unavailable\"\n}"
                                },
                                "url": {
                                    "raw": "{{base_url}}/call-requests/{{CALL_REQUEST_ID}}/reschedule",
                                    "host": ["{{base_url}}"],
                                    "path": ["call-requests", "{{CALL_REQUEST_ID}}", "reschedule"]
                                }
                            }
                        },
                        {
                            "name": "Update Call Link",
                            "request": {
                                "method": "PATCH",
                                "header": [
                                    {
                                        "key": "Content-Type",
                                        "value": "application/json"
                                    }
                                ],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"callLink\": \"https://zoom.us/j/987654321\",\n    \"platform\": \"zoom\"\n}"
                                },
                                "url": {
                                    "raw": "{{base_url}}/call-requests/{{CALL_REQUEST_ID}}/call-link",
                                    "host": ["{{base_url}}"],
                                    "path": ["call-requests", "{{CALL_REQUEST_ID}}", "call-link"]
                                }
                            }
                        }
                    ]
                },
                {
                    "name": "Call Session",
                    "item": [
                        {
                            "name": "Start Call",
                            "request": {
                                "method": "POST",
                                "header": [],
                                "url": {
                                    "raw": "{{base_url}}/call-requests/{{CALL_REQUEST_ID}}/start",
                                    "host": ["{{base_url}}"],
                                    "path": ["call-requests", "{{CALL_REQUEST_ID}}", "start"]
                                }
                            }
                        },
                        {
                            "name": "End Call",
                            "request": {
                                "method": "POST",
                                "header": [
                                    {
                                        "key": "Content-Type",
                                        "value": "application/json"
                                    }
                                ],
                                "body": {
                                    "mode": "raw",
                                    "raw": "{\n    \"recordingUrl\": \"https://storage.example.com/recordings/call-123.mp4\"\n}"
                                },
                                "url": {
                                    "raw": "{{base_url}}/call-requests/{{CALL_REQUEST_ID}}/end",
                                    "host": ["{{base_url}}"],
                                    "path": ["call-requests", "{{CALL_REQUEST_ID}}", "end"]
                                }
                            }
                        },
                        {
                            "name": "Mark No-Show",
                            "request": {
                                "method": "POST",
                                "header": [],
                                "url": {
                                    "raw": "{{base_url}}/call-requests/{{CALL_REQUEST_ID}}/no-show",
                                    "host": ["{{base_url}}"],
                                    "path": ["call-requests", "{{CALL_REQUEST_ID}}", "no-show"]
                                }
                            }
                        }
                    ]
                },
                {
                    "name": "Subscriber Queries",
                    "item": [
                        {
                            "name": "Get Subscriber Calls",
                            "request": {
                                "method": "GET",
                                "header": [],
                                "url": {
                                    "raw": "{{base_url}}/call-requests/subscriber/{{USER_ID}}?limit=20&offset=0",
                                    "host": ["{{base_url}}"],
                                    "path": ["call-requests", "subscriber", "{{USER_ID}}"],
                                    "query": [
                                        {
                                            "key": "limit",
                                            "value": "20"
                                        },
                                        {
                                            "key": "offset",
                                            "value": "0"
                                        }
                                    ]
                                }
                            }
                        },
                        {
                            "name": "Get Call Minutes Summary",
                            "request": {
                                "method": "GET",
                                "header": [],
                                "url": {
                                    "raw": "{{base_url}}/call-requests/subscriber/{{USER_ID}}/minutes?startDate=2025-01-01&endDate=2025-12-31",
                                    "host": ["{{base_url}}"],
                                    "path": ["call-requests", "subscriber", "{{USER_ID}}", "minutes"],
                                    "query": [
                                        {
                                            "key": "startDate",
                                            "value": "2025-01-01"
                                        },
                                        {
                                            "key": "endDate",
                                            "value": "2025-12-31"
                                        }
                                    ]
                                }
                            }
                        }
                    ]
                },
                {
                    "name": "Provider Queries",
                    "item": [
                        {
                            "name": "Get Provider Calls",
                            "request": {
                                "method": "GET",
                                "header": [],
                                "url": {
                                    "raw": "{{base_url}}/call-requests/provider/{{PROVIDER_ID}}?limit=20&offset=0",
                                    "host": ["{{base_url}}"],
                                    "path": ["call-requests", "provider", "{{PROVIDER_ID}}"],
                                    "query": [
                                        {
                                            "key": "limit",
                                            "value": "20"
                                        },
                                        {
                                            "key": "offset",
                                            "value": "0"
                                        }
                                    ]
                                }
                            }
                        },
                        {
                            "name": "Get Provider Upcoming Calls",
                            "request": {
                                "method": "GET",
                                "header": [],
                                "url": {
                                    "raw": "{{base_url}}/call-requests/provider/{{PROVIDER_ID}}/upcoming?limit=10",
                                    "host": ["{{base_url}}"],
                                    "path": ["call-requests", "provider", "{{PROVIDER_ID}}", "upcoming"],
                                    "query": [
                                        {
                                            "key": "limit",
                                            "value": "10"
                                        }
                                    ]
                                }
                            }
                        },
                        {
                            "name": "Check Provider Availability",
                            "request": {
                                "method": "GET",
                                "header": [],
                                "url": {
                                    "raw": "{{base_url}}/call-requests/provider/{{PROVIDER_ID}}/availability?scheduledAt=2025-12-20T14:00:00Z&durationMinutes=30",
                                    "host": ["{{base_url}}"],
                                    "path": ["call-requests", "provider", "{{PROVIDER_ID}}", "availability"],
                                    "query": [
                                        {
                                            "key": "scheduledAt",
                                            "value": "2025-12-20T14:00:00Z"
                                        },
                                        {
                                            "key": "durationMinutes",
                                            "value": "30"
                                        }
                                    ]
                                }
                            }
                        }
                    ]
                },
                {
                    "name": "Admin Queries",
                    "item": [
                        {
                            "name": "Get Overdue Calls",
                            "request": {
                                "method": "GET",
                                "header": [],
                                "url": {
                                    "raw": "{{base_url}}/call-requests/admin/overdue",
                                    "host": ["{{base_url}}"],
                                    "path": ["call-requests", "admin", "overdue"]
                                }
                            }
                        },
                        {
                            "name": "Get Scheduled Calls",
                            "request": {
                                "method": "GET",
                                "header": [],
                                "url": {
                                    "raw": "{{base_url}}/call-requests/admin/scheduled?startDate=2025-12-01&endDate=2025-12-31&providerId={{PROVIDER_ID}}",
                                    "host": ["{{base_url}}"],
                                    "path": ["call-requests", "admin", "scheduled"],
                                    "query": [
                                        {
                                            "key": "startDate",
                                            "value": "2025-12-01"
                                        },
                                        {
                                            "key": "endDate",
                                            "value": "2025-12-31"
                                        },
                                        {
                                            "key": "providerId",
                                            "value": "{{PROVIDER_ID}}"
                                        }
                                    ]
                                }
                            }
                        }
                    ]
                }
            ]
        },
        {
            "name": "Account",
            "item": [
                {
                    "name": "Register User",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"email\": \"user@example.com\",\n  \"password\": \"SecurePass123!\",\n  \"name\": \"John Doe\",\n  \"phone\": \"+1234567890\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/account/register",
                            "host": ["{{base_url}}"],
                            "path": ["account", "register"]
                        }
                    }
                },
                {
                    "name": "Login User",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"email\": \"user@example.com\",\n  \"password\": \"SecurePass123!\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/account/login",
                            "host": ["{{base_url}}"],
                            "path": ["account", "login"]
                        }
                    }
                },
                {
                    "name": "Reset Password",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"email\": \"user@example.com\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/account/reset-password",
                            "host": ["{{base_url}}"],
                            "path": ["account", "reset-password"]
                        }
                    }
                },
                {
                    "name": "Verify Email",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"token\": \"verification_token_here\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/account/verify-email",
                            "host": ["{{base_url}}"],
                            "path": ["account", "verify-email"]
                        }
                    }
                },
                {
                    "name": "Verify Phone",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"code\": \"123456\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/account/verify-phone",
                            "host": ["{{base_url}}"],
                            "path": ["account", "verify-phone"]
                        }
                    }
                },
                {
                    "name": "Logout",
                    "request": {
                        "method": "POST",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/account/logout",
                            "host": ["{{base_url}}"],
                            "path": ["account", "logout"]
                        }
                    }
                }
            ]
        },
        {
            "name": "Profile",
            "item": [
                {
                    "name": "Get Profile",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/profile/me",
                            "host": ["{{base_url}}"],
                            "path": ["profile", "me"]
                        }
                    }
                },
                {
                    "name": "Update Email",
                    "request": {
                        "method": "PATCH",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"email\": \"newemail@example.com\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/profile/email",
                            "host": ["{{base_url}}"],
                            "path": ["profile", "email"]
                        }
                    }
                },
                {
                    "name": "Update Phone",
                    "request": {
                        "method": "PATCH",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"phone\": \"+9876543210\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/profile/phone",
                            "host": ["{{base_url}}"],
                            "path": ["profile", "phone"]
                        }
                    }
                },
                {
                    "name": "Update Address",
                    "request": {
                        "method": "PATCH",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"street\": \"123 Main St\",\n  \"city\": \"New York\",\n  \"state\": \"NY\",\n  \"zipCode\": \"10001\",\n  \"country\": \"USA\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/profile/address",
                            "host": ["{{base_url}}"],
                            "path": ["profile", "address"]
                        }
                    }
                },
                {
                    "name": "Change Password",
                    "request": {
                        "method": "PATCH",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"currentPassword\": \"OldPass123!\",\n  \"newPassword\": \"NewPass456!\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/profile/password",
                            "host": ["{{base_url}}"],
                            "path": ["profile", "password"]
                        }
                    }
                }
            ]
        },
        {
            "name": "System",
            "item": [
                {
                    "name": "Health Check",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/health",
                            "host": ["{{base_url}}"],
                            "path": ["health"]
                        }
                    }
                },
                {
                    "name": "Version",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/version",
                            "host": ["{{base_url}}"],
                            "path": ["version"]
                        }
                    }
                }
            ]
        }
    ]
}
